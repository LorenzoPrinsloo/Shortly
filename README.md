# Shortly
Short URL generator

## API's

### Generate Short URL

Generated a shortened URL that redirects to the supplied URL

**URL** : `/shorten`

**Method** : `POST`

**Request Body** :
    
    {
        "url": "https://www.youtube.com/watch?v=_Rnrx2lo9cw"
    }

**Response Body** :

**Code** : `200 OK`

    {
        "id": "4bb13ed1-4a78-3281-94cf-3e9e43395ed1", // id of the shortened URL
        "url": "localhost:8080/ly/4bb13ed1" // shortened URL
    }


### List Available Short URL's

List all current short URL redirects and the original URL they redirect to.

**URL** : `/list`

**Method** : `GET`

**Response Body** :

**Code** : `200 OK`

    {
        "mappings": [
            {
                "shortUrl": "localhost:8080/ly/c7960131",
                "originalUrl": "https://www.udemy.com/course/scala-advanced-part-2/learn/lecture/9170246#overview"
            },
            {
                "shortUrl": "localhost:8080/ly/4bb13ed1",
                "originalUrl": "https://www.youtube.com/watch?v=sxon2U1eZS8"
            }
        ]
    }

### Redirect

Takes in a short URL identifier and redirects to the original URL.
It also records some basic statistics about the redirect for aggregation data.
The URL generated by the *Generate Short URL* points to this endpoint.

**URL** : `/ly`

**Method** : `GET`

**Response Body** :

**Code** : `307 Temporary Redirect`

**Header** : `Location -> [Original URL]`

### Redirect Statistics

Returns some basic redirect statistics for all short urls or 
if a Id is provided, filters the results to the specific Short URL mapping.

**URL** : `/stats/:?id`

**URL Parameters** : `id=[UUID]` where id is the id provided by the `/shorten` API `[Optional]`

**Method** : `GET`

**Response Body** :

**Code** : `200 OK`

    {
        "stats": [
            {
                "shortlyUrl": "localhost:8080/ly/c7960131",
                "fullURL": "https://www.udemy.com/course/scala-advanced-part-2/learn/lecture/9170246#overview",
                "redirects": 3 // total number of redirects for the url
            },
            {
                "shortlyUrl": "localhost:8080/ly/4bb13ed1",
                "fullURL": "https://www.youtube.com/watch?v=sxon2U1eZS8",
                "redirects": 2
            }
        ]
    }

### Aggregated Statistics

Returns some basic hourly redirect statistics per short URL in the database or 
if a Id is provided, filters the results to the specific short URL mapping.

**URL** : `/stats/hourly/:?id`

**URL Parameters** : `id=[UUID]` where id is the id provided by the `/shorten` API `[Optional]`

**Method** : `GET`

**Response Body** :

**Code** : `200 OK`

    {
        "list": [
            {
                "hour": "2020-11-11 19:00:00.0",
                "redirects": 2
            }
        ]
    }
    
## Running via Docker

Open up a sbt shell and run the following commands

    update // resolve project dependencies

    docker:stage // generate native executable and dockerfile
    
this will generate a native executable for the project 
and a Dockerfile that points to the location of it.

Next run the following command in another terminal window in the Project Root folder

    docker-compose up --force-recreate
    
Which will use the configured docker-compose.yml to start up
 - a instance of the main REST app (shortly-app)
 - a  postgresql database instance (shortly-postgres)
 
Once that's run you should see the web-service start on port 8080

## Postman Collection

If you have [Postman](https://www.postman.com/) you can import my collection
 that has the API endpoints set up to use from the get go. *Located at src/main/resources/Shortly.postman_collection.json*

